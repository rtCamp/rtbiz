!function(f){"use strict";var c;redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{},redux.field_objects.media.init=function(e){e=e||f(document).find(".redux-group-tab:visible").find(".redux-container-media:visible"),f(e).each(function(){var e=f(this),i=e;e.hasClass("redux-field-container")||(i=e.parents(".redux-field-container:first")),i.is(":hidden")||i.hasClass("redux-field-init")&&(i.removeClass("redux-field-init"),void 0===redux.field_objects.pro&&void 0!==redux.field_objects.image_filters&&(redux.field_objects.image_filters.sliderInit(e,"media"),redux.field_objects.image_filters.checkbox(e,"media")),c=!1,e.find(".remove-image, .remove-file").off("click").on("click",function(){redux.field_objects.media.removeFile(f(this).parents("fieldset.redux-field:first"))}),e.find(".media_upload_button").off().on("click",function(e){redux.field_objects.media.addFile(e,f(this).parents("fieldset.redux-field:first"))}))})},redux.field_objects.media.addFile=function(e,i){var d,t,a,s,o,r,l,n,u=f(this);e.preventDefault(),d||(void 0!==(a=f(i).find(".library-filter").data("lib-filter"))&&""!==a&&(t=[],c=!0,a=decodeURIComponent(a),a=JSON.parse(a),f.each(a,function(e,i){t.push(i)})),(d=wp.media({multiple:!1,library:{type:t},title:u.data("choose"),button:{text:u.data("update")}})).on("select",function(){var e=d.state().get("selection").first();if(d.close(),s=f(i).find(".data").data(),void 0===redux.field_objects.media?redux.field_objects.media={}:redux.field_objects.media,void 0!==s&&"undefined"!==s.mode||(s={mode:"image"}),!0===c&&(s.mode=0),0===s.mode||!1===s.mode||e.attributes.type===s.mode||e.attributes.subtype===s.mode){if(i.find(".upload").val(e.attributes.url),i.find(".upload-id").val(e.attributes.id),i.find(".upload-height").val(e.attributes.height),i.find(".upload-width").val(e.attributes.width),redux_change(f(i).find(".upload-id")),o=e.attributes.url,void 0!==e.attributes.sizes&&void 0!==e.attributes.sizes.thumbnail)"thumbnail"===s.previewSize&&(o=e.attributes.sizes.thumbnail.url);else if(void 0!==e.attributes.sizes)for(l in r=e.attributes.height,e.attributes.sizes)e.attributes.sizes.hasOwnProperty(l)&&(n=e.attributes.sizes[l]).height<r&&(r=n.height,o=n.url);else o=e.attributes.icon;i.find(".upload-thumbnail").val(o),i.find(".upload").hasClass("noPreview")||i.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+o+'">').slideDown("fast"),i.find(".remove-image").removeClass("hide"),i.find(".redux-background-properties").slideDown()}})),d.open()},redux.field_objects.media.removeFile=function(e){e.find(".remove-image").addClass("hide")&&(e.find(".remove-image").addClass("hide"),e.find(".upload").val(""),e.find(".upload-id").val(""),e.find(".upload-height").val(""),e.find(".upload-width").val(""),e.find(".upload-thumbnail").val(""),redux_change(f(e).find(".upload-id")),e.find(".redux-background-properties").hide(),e.find(".screenshot").slideUp(),e.find(".remove-file").off(),0<e.find(".section-upload .upload-notice").length&&e.find(".media_upload_button").remove())}}(jQuery);